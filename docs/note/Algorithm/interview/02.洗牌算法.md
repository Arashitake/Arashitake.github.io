---
title: 洗牌算法
date: 2020-10-18
---

::: info
笔记整理: [卡牌大师：玩转“洗牌算法”，幸运女神在微笑 (_^\_^_)](https://juejin.cn/post/6984925268754317320)
作者：掘金安东尼
来源：稀土掘金

:::

==题目：给你一副崭新的扑克牌（54 张），你如何 “洗乱” 它？？==
题目转换：一个数组 `nums = [1,2,3,4,5,...,51,52,53,54]`，求解：一个乱序的新数组 radomNums。

@[code{1-13} js](./02.洗牌算法.js)

## 青铜洗牌 🤬：暴力抽取

::: tip 思路
在 1 至 54 之前随机生成一个整数，然后把它放到新数组里，然后再随机生成一个整数，如果和之前生成的没重复，直接放入新数组，如果和之前重复了，那再随机生成一个。
这样直至数组中所有数字都被抽取放到新数组，最终得解！
:::

@[code{15-35} js](./02.洗牌算法.js)

:::danger 缺点
基本上打乱这副扑克牌要洗 200 ~ 300 次，因为越往后，生成随机数重复的概率就越大。
:::

## 白银洗牌 📍: 交互位置

::: tip 思路
将牌随机分成两堆，让它们交换，然后再随机分成两堆，再让它们交换，然后再随机分出两堆......这样重复洗十几、二十次后，完成洗牌。
在现实中，我们玩牌，大部分玩家也是这样去洗的，它也叫**【印度洗牌法】**
![印度洗牌法](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58128bd6d32b497aa4ce25f29c903d8a~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image)
:::

@[code{39-61} js](./02.洗牌算法.js)

:::danger 缺点
没有体现最需要的 “洗乱” 的含义，即：每个位置出现每张牌的可能性都相同
:::

## 黄金洗牌 💡: 交互位置

::: tip 思路
洗牌问题最最关键的 “洗乱” 二字意义：==随机的结果要能够覆盖所有的情况，并且随机结果出现的概率相等==
洗 54 张牌，随机结果需覆盖所有情况就应该是 54 张牌的排列方式，$A^54_54$，即 $54!$（54 的阶层）种随机结果。
两两对换：
洗 1 次，会得到 $n$ 种可能的结果；
洗 2 次，会得到 $n*(n-1)$ 种结果；
洗 3 次，会得到 $n*(n-1)*(n-2)$ 种结果；
......
洗 n 次之后，我们才满足了：随机结果【覆盖所有情况】，并且所有随机结果【出现概率相等】。
所以，必须洗 54 次，才能达到目的。
:::

@[code{63-81} js](./02.洗牌算法.js)

## 铂金洗牌 🤣: Fisher-Yates

::: info
洗牌算法 Fisher–Yates 随机置乱算法也被称做高纳德置乱算法，**通俗说就是生成一个有限集合的随机排列**。
Fisher–Yates shuffle：是一种基于有限序列产生随机排列的算法。因为每次抽取每个元素都是等概率的，所以该算法产生一个无偏排列：每个排列的可能性相等。
:::

::: tip 思路
随机生成 1 至 54 之间的整数，将它和数组的最后一位替换；
然后再在 1 至 53 之间随机生成一位整数，将它和数组的倒数第二位替换；
然后再 1 至 52 之间随机生成一位整数，将它和数组的倒数第三位替换；
......
直至在 1 至 1 之间随机生成一位整数（即 1），将它和数组第 1 位替换（即替换自身）；
![example](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9586913f2858489587ef2d88df41eb92~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?)
这样做，时间复杂度为 O(n)，且任意一张牌出现的概率都是 1/52，满足：随机结果覆盖所有情况，随机结果出现概率相等！
:::

数学证明：一张牌被放到第 i 个位置的机率为 P，则 P 会等于前 i-1 个位置都未选到这张牌且第 i 个位置选到这张牌。
![数学证明](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93dc3c2a335d468395fa8daa7a59fc11~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?)

@[code{85-97} js](./02.洗牌算法.js)

## 钻石洗牌 😎：Riffle Shuffle

::: tip 思路
鸽尾式洗牌法（Riffle Shuffle）

现实中很多扑克高玩都会这样洗吧（一图胜千言）
![鸽尾式洗牌法](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ae8e83d53d64887b2279c4a5de21d64~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image)

原理：将数组一分为二，再穿插合并，再不断重复这样的操作
![原理](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78c042957e1c4a3aa806e47e4c91b318~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image?)
研究表明：**用鸽尾式洗牌法【洗七次】是最有效的打乱手法！**
:::

@[code{112-128} js](./02.洗牌算法.js)

:::danger 缺点
是不完美的“完美洗牌法”，详见扩展阅读。
:::

## 大师洗牌 😏

::: tip 思路
大师说：“把牌洗乱固然重要，但是能不能，把牌洗乱之后，还能发给自己想要的牌？！”
抽奖池！
目标：将 54 张牌打乱后，抽到区间 [1,10] 的概率为 40%，抽到区间 [11,20] 的概率为 20%，抽到区间 [21,30] 的概率为 20%，抽到区间 [31,40] 的概率为 15%，剩下的抽到 [41,54] 的概率为 5%；
:::

```js
// 思路：我们实现乱序数组的同时，输出一个概率数组。
radomNums = [21,43,12,3,...,8,6,33] // 共 54 项
probabilityNums = [0.02,0.015,...,0.04,0.04,0.15] // 共 54 项，和为 1

// 然后再通过以下 randomProbability 拿出发牌的值
const randomProbability = (arr1, arr2) => {
  let sum = 0, factor = 0;
  let random = Math.random();
  for(let i = arr2.length-1; i > 0; i++) {
    sum += arr2[i]; // 统计概率总和
  }
  random *= sum;  // 生成概率随机数
  for(let i = arr2.length-1; i > 0; i++) {
    factor += arr2[i];
    // 如果在当前的概率范围内，得到的就说当前概率，返回输出
    if(random <= factor) return arr1[i];
    return null;
  };

  const yourCard = randomProbability(radomNums, probabilityNums);
  console.log(yourCard);
```

## 扩展阅读

1. [不完美的“完美洗牌法”](https://zhuanlan.zhihu.com/p/29178813)
2. [完美的“洗”牌？](https://zhuanlan.zhihu.com/p/29181958)
3. [应用鸽巢原理的纸牌魔术一则](https://zhuanlan.zhihu.com/p/29213136)
